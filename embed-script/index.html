<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SignalWire C2C Widget</title>
  </head>
  <body>
    <button id="callButton1">Call Sigmond (chat only)</button>

    <call-widget
      button-id="callButton1"
      token="c2c_3eaa2a89d96107a630fff087bc255e27"
      support-video="true"
      support-audio="true"
      destination="/private/demo-1"
      log-level="info"
      window-mode="video+transcript"
    ></call-widget>

    <script type="module" src="/src/index.ts"></script>

    <script type="module">
      import { showContactForm } from "/src/lib/contactForm.js";

      document.addEventListener("DOMContentLoaded", function () {
        const widget = document.querySelector("call-widget");

        widget.addEventListener("beforeDial", function (event) {
          const approve = event.detail.approve;
          const reject = event.detail.reject;

          showContactForm({
            onSubmit: (data) => {
              console.log("Form submitted:", data);

              // fetch("https://swrooms.com/form_handler", {
              fetch("http://localhost:3000/submit", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              }).catch((error) => {
                console.error("Form submission error:", error);
              });

              approve();
            },
            onCancel: () => {
              console.log("Form cancelled");
              reject();
            },
          });
        });
      });
    </script>
  </body>
</html>
